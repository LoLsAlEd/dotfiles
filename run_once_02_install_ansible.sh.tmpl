#!/bin/bash

# Ensure Homebrew is available
if ! command -v brew &> /dev/null; then
    echo "[ERROR] Homebrew not found. Please run install_homebrew script first."
    exit 1
fi

echo -e "[INFO] Installing Ansible..."
brew install ansible

OS="$(uname -s)"
case "${OS}" in
    Linux*)
        echo -e "[INFO] Running Ansible playbook for Linux setup..."
        ansible-playbook {{ joinPath .chezmoi.sourceDir "dot_bootstrap/setup-linux.yml" | quote }} --ask-become-pass
        ;;
    Darwin*)
        echo -e "[INFO] Running Ansible playbook for Mac setup..."
        ansible-playbook {{ joinPath .chezmoi.sourceDir "dot_bootstrap/setup-mac.yml" | quote }} --ask-become-pass
        ;;
    *)
        echo "[ERROR] Unsupported operating system: ${OS}"
        exit 1
        ;;
esac

echo "[SUCCESS] Ansible installation and setup complete."
